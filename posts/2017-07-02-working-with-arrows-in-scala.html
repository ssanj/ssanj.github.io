<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Working with Arrows in Scala</title>
    <meta name="viewport" content="width=device-width">
    
    <meta name="description" content="An overview of functions on the Arrow typeclass in Scala with Cats and Scalaz">
    
    <link rel="canonical" href="https://blog.ssanj.net/posts/2017-07-02-working-with-arrows-in-scala.html">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/main-2020-09-17.css">
    <link rel="stylesheet" href="../css/syntax-2020-09-17.css">
    <link rel="stylesheet" type="text/css" href="../css/example.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    
  </head>

    <body>
      
          <div class="page-content">
      <div class="wrap">
        <div class="post">
          <header class="post-header">
            <h1><a href="../">Working with Arrows in Scala</a></h1>
            <p class="meta">July  2, 2017&nbsp;<span class="post-tag"><a title="All pages tagged 'arrows'." href="../tags/arrows.html">arrows</a>, <a title="All pages tagged 'scala'." href="../tags/scala.html">scala</a></span></p>
          </header>
          <article class="post-content">
            <p>In the <a href="http://sanj.ink/posts/2017-06-12-reading-configuration-with-kleisli-arrows.html">last article</a> we looked at how we could read configuration with a Kleisli Arrow similar to using a Reader Monad.</p>
<p>We’ve been using Arrows for the last couple of articles but haven’t defined what an Arrow is exactly.</p>
<p>An Arrow is a computation that runs within a context which takes in an input and returns an output. A more detailed explanation from <a href="https://wiki.haskell.org/Typeclassopedia#Arrow">Typeclassopedia</a> states:</p>
<blockquote>
<p>The Arrow class represents another abstraction of computation, in a similar vein to Monad and Applicative. However, unlike Monad and Applicative, whose types only reflect their output, the type of an Arrow computation reflects both its input and output. Arrows generalize functions: if arr is an instance of Arrow, a value of type b <code>arr</code> c can be thought of as a computation which takes values of type b as input, and produces values of type c as output. In the (-&gt;) instance of Arrow this is just a pure function; in general, however, an arrow may represent some sort of “effectful” computation</p>
</blockquote>
<p>In <a href="http://typelevel.org/cats/">Cats</a> the <a href="https://github.com/typelevel/cats/blob/series/0.8.x/core/src/main/scala/cats/arrow/Arrow.scala#L8">Arrow typeclass</a> is defined with the type constructor F which has two type holes:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Arrow<span class="op">[</span>F<span class="op">[</span>_<span class="op">,</span> _<span class="op">]]</span> <span class="co">//simplified</span></span></code></pre></div>
<p>These two type holes correspond to the input and output types of the Arrow respectively. <strong>F</strong> can be any type constructor that takes two types and performs a mapping between them. A <strong>scala.Function1</strong> is an example of <strong>F</strong>, as is the <strong>Kleisli Arrow</strong> we saw in previous articles. It might be helpful to think of Arrows as simple functions from one type to another for the moment.</p>
<p>Lets now go through some of the functions defined on Arrow and how they are used. For the remainder of the article lets assume that the type constructor supplied to Arrow is a <a href="http://www.scala-lang.org/api/current/scala/Function1.html"><strong>scala.Function1</strong></a>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">trait</span> Function1<span class="op">[-</span>T1<span class="op">,</span> <span class="op">+</span>R<span class="op">]</span> <span class="kw">extends</span> <span class="bu">AnyRef</span></span></code></pre></div>
<p>and the resulting Arrow is:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> fa <span class="op">=</span> Arrow<span class="op">[</span>Function1<span class="op">]</span></span></code></pre></div>
<h3 id="liftarr"><a href="https://github.com/typelevel/cats/blob/series/0.8.x/core/src/main/scala/cats/arrow/Arrow.scala#L13">lift</a>/<a href="https://github.com/scalaz/scalaz/blob/series/7.3.x/core/src/main/scala/scalaz/Arrow.scala#L16">arr</a></h3>
<p>This is a simple function to construct an Arrow given its input and output types. This is defined in Cats as:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lift<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>f<span class="op">:</span> A <span class="op">=&gt;</span> B<span class="op">):</span> F<span class="op">[</span>A<span class="op">,</span> B<span class="op">]</span></span></code></pre></div>
<p>For example to lift a function that goes from a <strong>String</strong> to an <strong>Int</strong> into <strong>F</strong> we’d do:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> findLength<span class="op">:</span> <span class="ex">String</span> <span class="op">=&gt;</span> <span class="bu">Int</span> <span class="op">=</span> _<span class="op">.</span>length</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>fa<span class="op">.</span><span class="fu">lift</span><span class="op">(</span>f<span class="op">)</span> <span class="co">//Function1[String, Int]</span></span></code></pre></div>
<p>Since <strong>findLength</strong> is already a <strong>scala.Function1</strong> it is a little pointless to lift it into a <strong>scala.Function1</strong> but hopefully its usage is clear.</p>
<p>In <a href="https://github.com/scalaz">Scalaz</a> this function is defined as arr:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> arr<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>f<span class="op">:</span> A <span class="op">=&gt;</span> B<span class="op">):</span> A <span class="op">=&gt;:</span> B</span></code></pre></div>
<p>where <strong>=&gt;:</strong> is a typeconstructor similar to <strong>F</strong>.</p>
<h3 id="id"><a href="https://github.com/typelevel/cats/blob/series/0.8.x/core/src/main/scala/cats/arrow/Category.scala#L11">id</a></h3>
<p>The <strong>id</strong> function is defined as:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> id<span class="op">[</span>A<span class="op">]:</span> F<span class="op">[</span>A<span class="op">,</span> A<span class="op">]</span></span></code></pre></div>
<p>The type signature of the above tells us that <strong>F</strong> returns the input type A as its output, essentially giving us the <a href="http://www.scala-lang.org/api/2.11.11/index.html#scala.Predef$@identity%5BA%5D(x:A):A">identity</a> function.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> intF1 <span class="op">=</span> fa<span class="op">.</span>id<span class="op">[</span><span class="bu">Int</span><span class="op">]</span> <span class="co">//Function1[Int, Int]</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">intF1</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span> <span class="co">//returns 10</span></span></code></pre></div>
<h3 id="first"><a href="https://github.com/typelevel/cats/blob/series/0.8.x/core/src/main/scala/cats/functor/Strong.scala#L24">first</a></h3>
<p>The <strong>first</strong> function is defined as:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> first<span class="op">[</span>A<span class="op">,</span> B<span class="op">,</span> C<span class="op">](</span>fa<span class="op">:</span> F<span class="op">[</span>A<span class="op">,</span> B<span class="op">]):</span> F<span class="op">[(</span>A<span class="op">,</span> C<span class="op">),</span> <span class="op">(</span>B<span class="op">,</span> C<span class="op">)]</span></span></code></pre></div>
<p>The <strong>first</strong> function takes Arrow <strong>fa</strong> from <strong>A</strong> =&gt; <strong>B</strong> and returns another Arrow (<strong>A</strong>, <strong>C</strong>) =&gt; (<strong>B</strong>, <strong>C</strong>). It applies the function in <strong>fa</strong> to the first parameter of the tuple, which is an <strong>A</strong> and converts it to a <strong>B</strong>. The second parameter of the tuple it leaves untouched and returns a (<strong>B</strong>, <em>C</em>).</p>
<figure>
<img src="../images/arrow-functions/arrow-first3.jpg" alt="First" />
<figcaption aria-hidden="true">First</figcaption>
</figure>
<p>For the remaining examples we have the following definitions at our disposal:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">final</span> <span class="cf">case</span> <span class="kw">class</span> <span class="ex">Name</span><span class="op">(</span>first<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> last<span class="op">:</span> <span class="ex">String</span><span class="op">)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">final</span> <span class="cf">case</span> <span class="kw">class</span> <span class="fu">Age</span><span class="op">(</span>age<span class="op">:</span> <span class="bu">Int</span><span class="op">)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">final</span> <span class="cf">case</span> <span class="kw">class</span> <span class="fu">Person</span><span class="op">(</span>name<span class="op">:</span> <span class="ex">Name</span><span class="op">,</span> age<span class="op">:</span> Age<span class="op">)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> name <span class="op">=</span> <span class="ex">Name</span><span class="op">(</span><span class="st">&quot;Nagate&quot;</span><span class="op">,</span> <span class="st">&quot;Tanikaze&quot;</span><span class="op">)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> age <span class="op">=</span> <span class="fu">Age</span><span class="op">(</span><span class="dv">22</span><span class="op">)</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> upperFirstName<span class="op">:</span> <span class="ex">String</span> <span class="op">=&gt;</span> <span class="ex">String</span> <span class="op">=</span> _<span class="op">.</span>toUpperCase</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> doubleNumber<span class="op">:</span> <span class="bu">Int</span> <span class="op">=&gt;</span> <span class="bu">Int</span> <span class="op">=</span> _ <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> upperName<span class="op">:</span> <span class="ex">Name</span> <span class="op">=&gt;</span> <span class="ex">Name</span> <span class="op">=</span> n <span class="op">=&gt;</span> <span class="ex">Name</span><span class="op">(</span><span class="fu">upperFirstName</span><span class="op">(</span>n<span class="op">.</span>first<span class="op">),</span> n<span class="op">.</span>last<span class="op">)</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> doubleAge<span class="op">:</span> Age <span class="op">=&gt;</span> Age <span class="op">=</span> a <span class="op">=&gt;</span> <span class="fu">Age</span><span class="op">(</span><span class="fu">doubleNumber</span><span class="op">(</span>a<span class="op">.</span>age<span class="op">))</span></span></code></pre></div>
<p>For example if we wanted to apply a function to the <strong>Name</strong> element of a <strong>Name</strong> and <strong>Age</strong> pair and but wanted to leave the <strong>Age</strong> element untouched we could do:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> onlyNameF<span class="op">:</span> <span class="op">((</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">))</span> <span class="op">=&gt;</span> <span class="op">(</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">)</span> <span class="op">=</span> fa<span class="op">.</span>first<span class="op">[</span><span class="ex">Name</span><span class="op">,</span> <span class="ex">Name</span><span class="op">,</span> Age<span class="op">](</span>upperName<span class="op">)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> toPersonF<span class="op">:</span> <span class="op">((</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">))</span> <span class="op">=&gt;</span> Person <span class="op">=</span> onlyNameF <span class="fu">andThen</span> <span class="op">(</span>Person<span class="op">.</span>apply _<span class="op">).</span>tupled</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">toPersonF</span><span class="op">(</span>name<span class="op">,</span> age<span class="op">)</span> <span class="co">//returns Person(Name(NAGATE,Tanikaze),Age(22))</span></span></code></pre></div>
<p>Notice how the <strong>Age</strong> value of the input is unchanged.</p>
<h3 id="second"><a href="https://github.com/typelevel/cats/blob/series/0.8.x/core/src/main/scala/cats/functor/Strong.scala#L39">second</a></h3>
<p>The <strong>second</strong> function is very similar to <strong>first</strong> only with its parameters switched. It is defined as:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> second<span class="op">[</span>A<span class="op">,</span> B<span class="op">,</span> C<span class="op">](</span>fa<span class="op">:</span> F<span class="op">[</span>A<span class="op">,</span> B<span class="op">]):</span> F<span class="op">[(</span>C<span class="op">,</span> A<span class="op">),</span> <span class="op">(</span>C<span class="op">,</span> B<span class="op">)]</span></span></code></pre></div>
<p>The <strong>second</strong> function takes Arrow <strong>fa</strong> from <strong>A</strong> =&gt; <strong>B</strong> and returns another Arrow with takes in a tuple of (<strong>C</strong>, <strong>A</strong>) =&gt; (<strong>C</strong>, <strong>B</strong>). It applies the function in <strong>fa</strong> to the second parameter of the tuple <strong>A</strong> and converts it to a <strong>B</strong>. The first parameter of the tuple it leaves untouched and returns a (<em>C</em>, <strong>B</strong>).</p>
<figure>
<img src="../images/arrow-functions/arrow-second2.jpg" alt="Second" />
<figcaption aria-hidden="true">Second</figcaption>
</figure>
<p>For example if we wanted to apply a function to the <strong>Age</strong> element of a <strong>Name</strong> and <strong>Age</strong> pair and but wanted to leave the <strong>Name</strong> element untouched we could do:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> onlyAgeF<span class="op">:</span> <span class="op">((</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">))</span> <span class="op">=&gt;</span> <span class="op">(</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">)</span> <span class="op">=</span> fa<span class="op">.</span>second<span class="op">[</span>Age<span class="op">,</span> Age<span class="op">,</span> <span class="ex">Name</span><span class="op">](</span>doubleAge<span class="op">)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> toPersonF<span class="op">:</span> <span class="op">((</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">))</span> <span class="op">=&gt;</span> Person <span class="op">=</span> onlyAgeF <span class="fu">andThen</span> <span class="op">(</span>Person<span class="op">.</span>apply _<span class="op">).</span>tupled</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">toPersonF</span><span class="op">(</span>name<span class="op">,</span> age<span class="op">)</span> <span class="co">//returns Person(Name(Nagate,Tanikaze),Age(44))</span></span></code></pre></div>
<p>Notice how the <strong>Name</strong> value of the input is unchanged.</p>
<h3 id="splitproduct"><a href="https://github.com/typelevel/cats/blob/series/0.8.x/core/src/main/scala/cats/arrow/Split.scala">split/product/***</a></h3>
<p>The <strong>split</strong> function is an application of <strong>first</strong> and <strong>second</strong>. It is defined as:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split<span class="op">[</span>A<span class="op">,</span> B<span class="op">,</span> C<span class="op">,</span> D<span class="op">](</span>f<span class="op">:</span> F<span class="op">[</span>A<span class="op">,</span> B<span class="op">],</span> g<span class="op">:</span> F<span class="op">[</span>C<span class="op">,</span> D<span class="op">]):</span> F<span class="op">[(</span>A<span class="op">,</span> C<span class="op">),</span> <span class="op">(</span>B<span class="op">,</span> D<span class="op">)]</span></span></code></pre></div>
<p>The <strong>split</strong> function takes Arrow <strong>f</strong> from <strong>A</strong> =&gt; <strong>B</strong> and an Arrow <strong>g</strong> from <strong>C</strong> =&gt; <strong>D</strong> and returns another Arrow with takes in a tuple of (<strong>A</strong>, <strong>C</strong>) =&gt; (<strong>B</strong>, <strong>D</strong>). It applies the function in <strong>f</strong> to the first parameter of the tuple <strong>A</strong> and converts it to a <strong>B</strong>. It also applies the function in <strong>g</strong> to the second parameter of the tuple <strong>C</strong> and converts it to a <strong>D</strong> returning a final result of (<strong>B</strong>, <strong>D</strong>). Split has the symbolic representation of <strong>***</strong> and is sometimes referred to as the <strong>product</strong> function because it applies multiple functions to multiple inputs.</p>
<figure>
<img src="../images/arrow-functions/arrow-split3.jpg" alt="Split" />
<figcaption aria-hidden="true">Split</figcaption>
</figure>
<p>For example if we wanted to apply a function to the <strong>Name</strong> and <strong>Age</strong> element of a <strong>Name</strong> and <strong>Age</strong> pair at once we could do:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> bothNameAndAgeF<span class="op">:</span> <span class="op">((</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">))</span> <span class="op">=&gt;</span> <span class="op">(</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">)</span> <span class="op">=</span> fa<span class="op">.</span>split<span class="op">[</span><span class="ex">Name</span><span class="op">,</span> <span class="ex">Name</span><span class="op">,</span> Age<span class="op">,</span> Age<span class="op">](</span>upperName<span class="op">,</span> doubleAge<span class="op">)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> toPersonF<span class="op">:</span> <span class="op">((</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">))</span> <span class="op">=&gt;</span> Person <span class="op">=</span> bothNameAndAgeF <span class="fu">andThen</span> <span class="op">(</span>Person<span class="op">.</span>apply _<span class="op">).</span>tupled</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">toPersonF</span><span class="op">(</span>name<span class="op">,</span> age<span class="op">)</span><span class="co">//Person(Name(NAGATE,Tanikaze),Age(44))</span></span></code></pre></div>
<h3 id="combinefanout"><a href="https://github.com/scalaz/scalaz/blob/series/7.3.x/core/src/main/scala/scalaz/Arrow.scala#L55">combine/fanout/&amp;&amp;&amp;</a></h3>
<p><strong>combine</strong> is defined as:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine<span class="op">[</span>A<span class="op">,</span> B<span class="op">,</span> C<span class="op">](</span>fab<span class="op">:</span> F<span class="op">[</span>A<span class="op">,</span> B<span class="op">],</span> fac<span class="op">:</span> <span class="op">=&gt;</span> F<span class="op">[</span>A<span class="op">,</span> C<span class="op">]):</span> F<span class="op">[</span>A<span class="op">,</span> <span class="op">(</span>B<span class="op">,</span> C<span class="op">)]</span></span></code></pre></div>
<p>Although Cats does not define <strong>combine</strong>, <a href="https://github.com/scalaz/scalaz/blob/series/7.3.x/core/src/main/scala/scalaz/Arrow.scala#L55">scalaz does</a>. For the purpose of this post I’ve created an implementation of <strong>combine</strong> in the <a href="https://github.com/ssanj/arrows/blob/master/src/main/scala/net/ssanj/arrow/ArrowFuncs.scala#L8">example source</a>.</p>
<p>The <strong>combine</strong> function takes Arrow <strong>fab</strong> from <strong>A</strong> =&gt; <strong>B</strong> and an Arrow <strong>fac</strong> from <strong>A</strong> =&gt; <strong>C</strong> and returns another Arrow which takes in an input of <strong>A</strong>, and returns a tuple of (<strong>B</strong>, <strong>C</strong>). It’s important to note that the same input <strong>A</strong> is supplied to both arrows <strong>fab</strong> and <strong>fac</strong>.</p>
<figure>
<img src="../images/arrow-functions/arrow-combine.jpg" alt="Combine" />
<figcaption aria-hidden="true">Combine</figcaption>
</figure>
<p>For example given a <strong>Person</strong> if we want to break it into primitive representations of its <strong>Name</strong> and <strong>Age</strong> fields we could do:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> person <span class="op">=</span> <span class="fu">Person</span><span class="op">(</span>name<span class="op">,</span> age<span class="op">)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> combineName<span class="op">:</span> Person <span class="op">=&gt;</span> <span class="ex">String</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="fu">Person</span><span class="op">(</span><span class="ex">Name</span><span class="op">(</span>first<span class="op">,</span> last<span class="op">),</span> _<span class="op">)</span> <span class="op">=&gt;</span> <span class="ss">s&quot;$first</span><span class="st"> </span><span class="ss">$last&quot;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> combineAge<span class="op">:</span> Person <span class="op">=&gt;</span> <span class="bu">Int</span> <span class="op">=</span> _<span class="op">.</span>age<span class="op">.</span>age</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> combineF<span class="op">:</span> Person <span class="op">=&gt;</span> <span class="op">(</span><span class="ex">String</span><span class="op">,</span> <span class="bu">Int</span><span class="op">)</span> <span class="op">=</span> ArrowFuncs<span class="op">.</span><span class="fu">combine</span><span class="op">(</span>combineName<span class="op">,</span> combineAge<span class="op">)</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">combineF</span><span class="op">(</span>person<span class="op">)</span> <span class="co">// (&quot;Nagate Tanikaze&quot;,22): (String, Int)</span></span></code></pre></div>
<p><strong>combine</strong> has a symbolic representation of <strong>&amp;&amp;&amp;</strong> and is sometimes referred to as the <strong>fanout</strong> function.</p>
<h3 id="lifta2">liftA2</h3>
<p><strong>liftA2</strong> is defined as:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> liftA2<span class="op">[</span>A<span class="op">,</span> B<span class="op">,</span> C<span class="op">,</span> D<span class="op">](</span>fab<span class="op">:</span> F<span class="op">[</span>A<span class="op">,</span> B<span class="op">],</span> fac<span class="op">:</span> F<span class="op">[</span>A<span class="op">,</span> C<span class="op">])(</span>f<span class="op">:</span> B <span class="op">=&gt;</span> C <span class="op">=&gt;</span> D<span class="op">):</span> F<span class="op">[</span>A<span class="op">,</span> D<span class="op">]</span> <span class="co">//simplified</span></span></code></pre></div>
<p>I could not find a definition of <strong>liftA2</strong> in either Cats nor Scalaz. I’ve referenced it here directly from the <a href="https://www.researchgate.net/publication/222520426_Generalising_monads_to_arrows">Generalising monads to arrows paper by John Hughes</a> in Haskell:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell scrollx"><code class="sourceCode haskell"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ot">liftA2 ::</span> <span class="dt">Arrow</span> a <span class="ot">=&gt;</span> (b <span class="ot">-&gt;</span> c <span class="ot">-&gt;</span> d) <span class="ot">-&gt;</span> a e b <span class="ot">-&gt;</span> a e c <span class="ot">-&gt;</span> a e d</span></code></pre></div>
<p>A sample of implementation of this can be found in the <a href="https://github.com/ssanj/arrows/blob/master/src/main/scala/net/ssanj/arrow/ArrowFuncs.scala#L13">example source</a>.</p>
<p>The <strong>liftA2</strong> function is very similar to the <strong>combine</strong> function with the addition of running a function on the result of <strong>combine</strong>.</p>
<p>The <strong>liftA2</strong> function takes an Arrow <strong>fab</strong> from <strong>A</strong> =&gt; <strong>B</strong>, an Arrow <strong>fac</strong> from <strong>A</strong> =&gt; <strong>C</strong> and a function <strong>f</strong> from <strong>B</strong> =&gt; <strong>C</strong> =&gt; <strong>D</strong> and returns another Arrow with takes in an input of <strong>A</strong>, and returns a <strong>D</strong>.</p>
<figure>
<img src="../images/arrow-functions/arrow-liftA2-2.jpg" alt="liftA2" />
<figcaption aria-hidden="true">liftA2</figcaption>
</figure>
<p>For example given a <strong>Person</strong> if we want to break it into primitive representations of its <strong>Name</strong> and <strong>Age</strong> fields and then apply a function on the separated bits we could do:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> person <span class="op">=</span> <span class="fu">Person</span><span class="op">(</span>name<span class="op">,</span> age<span class="op">)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> combineName<span class="op">:</span> Person <span class="op">=&gt;</span> <span class="ex">String</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="fu">Person</span><span class="op">(</span><span class="ex">Name</span><span class="op">(</span>first<span class="op">,</span> last<span class="op">),</span> _<span class="op">)</span> <span class="op">=&gt;</span> <span class="ss">s&quot;$first</span><span class="st"> </span><span class="ss">$last&quot;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> combineAge<span class="op">:</span> Person <span class="op">=&gt;</span> <span class="bu">Int</span> <span class="op">=</span> _<span class="op">.</span>age<span class="op">.</span>age</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> makePersonString<span class="op">:</span> <span class="ex">String</span> <span class="op">=&gt;</span> <span class="bu">Int</span> <span class="op">=&gt;</span> <span class="ex">String</span> <span class="op">=</span> name <span class="op">=&gt;</span> age <span class="op">=&gt;</span> <span class="ss">s&quot;</span><span class="st">person[name='</span><span class="ss">$name</span><span class="st">', age=</span><span class="ss">$age</span><span class="st">]</span><span class="ss">&quot;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> lifta2<span class="op">:</span> Person <span class="op">=&gt;</span> <span class="ex">String</span> <span class="op">=</span> ArrowFuncs<span class="op">.</span><span class="fu">liftA2</span><span class="op">(</span>combineName<span class="op">,</span> combineAge<span class="op">)(</span>makePersonString<span class="op">)</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lifta2</span><span class="op">(</span>person<span class="op">)</span> <span class="co">//&quot;person[name='Nagate Tanikaze', age=22]&quot;</span></span></code></pre></div>
<h3 id="compose-and-andthen"><a href="https://github.com/typelevel/cats/blob/series/0.8.x/core/src/main/scala/cats/arrow/Compose.scala#L12">compose/&lt;&lt;&lt;</a> and <a href="https://github.com/typelevel/cats/blob/series/0.8.x/core/src/main/scala/cats/arrow/Compose.scala#L15">andThen/&gt;&gt;&gt;</a></h3>
<p><strong>compose</strong> is defined as:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compose<span class="op">[</span>A<span class="op">,</span> B<span class="op">,</span> C<span class="op">](</span>f<span class="op">:</span> F<span class="op">[</span>B<span class="op">,</span> C<span class="op">],</span> g<span class="op">:</span> F<span class="op">[</span>A<span class="op">,</span> B<span class="op">]):</span> F<span class="op">[</span>A<span class="op">,</span> C<span class="op">]</span></span></code></pre></div>
<p>and has the symbolic representation of <strong>&lt;&lt;&lt;</strong>.</p>
<p><strong>andThen</strong> is defined as:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> andThen<span class="op">[</span>A<span class="op">,</span> B<span class="op">,</span> C<span class="op">](</span>f<span class="op">:</span> F<span class="op">[</span>A<span class="op">,</span> B<span class="op">],</span> g<span class="op">:</span> F<span class="op">[</span>B<span class="op">,</span> C<span class="op">]):</span> F<span class="op">[</span>A<span class="op">,</span> C<span class="op">]</span></span></code></pre></div>
<p>and has the symbolic representation of <strong>&gt;&gt;&gt;</strong>.</p>
<p><strong>compose</strong> and <strong>andThen</strong> are basically the same function with the first and second arguments swapped.</p>
<p>These functions combine arrows passing on the output of one arrow as the input to the next one, similar to regular function composition.</p>
<p>For example given a <strong>Name</strong> and <strong>Age</strong>, if we wanted to convert them to a <strong>Person</strong> and then covert the <strong>Person</strong> to a String we could do:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> personA<span class="op">:</span> Tuple2<span class="op">[</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">]</span> <span class="op">=&gt;</span> Person <span class="op">=</span> na <span class="op">=&gt;</span> <span class="fu">Person</span><span class="op">(</span>na<span class="op">.</span>_1<span class="op">,</span> na<span class="op">.</span>_2<span class="op">)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> makePersonStringA<span class="op">:</span> Person  <span class="op">=&gt;</span> <span class="ex">String</span> <span class="op">=</span> p <span class="op">=&gt;</span>  <span class="ss">s&quot;</span><span class="st">person[name='</span><span class="ss">${</span>p<span class="op">.</span>name<span class="op">.</span>first<span class="ss">}</span><span class="st">' </span><span class="ss">${</span>p<span class="op">.</span>name<span class="op">.</span>last<span class="ss">}</span><span class="st">, age=</span><span class="ss">${</span>p<span class="op">.</span>age<span class="ss">}</span><span class="st"> yrs]</span><span class="ss">&quot;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> composeF<span class="op">:</span> Tuple2<span class="op">[</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">]</span> <span class="op">=&gt;</span> <span class="ex">String</span> <span class="op">=</span> personA <span class="op">&gt;&gt;&gt;</span> makePersonStringA</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> andThenF<span class="op">:</span> Tuple2<span class="op">[</span><span class="ex">Name</span><span class="op">,</span> Age<span class="op">]</span> <span class="op">=&gt;</span> <span class="ex">String</span> <span class="op">=</span>  makePersonStringA <span class="op">&lt;&lt;&lt;</span> personA</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">composeF</span><span class="op">(</span>name<span class="op">,</span> age<span class="op">)</span> <span class="co">//person[name='Nagate' Tanikaze, age=Age(22) yrs]</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">andThenF</span><span class="op">(</span>name<span class="op">,</span> age<span class="op">)</span> <span class="co">//person[name='Nagate' Tanikaze, age=Age(22) yrs]</span></span></code></pre></div>
<h3 id="a-worked-example">A Worked Example</h3>
<p>We’ve learned a lot of functions which are somewhat cryptic until you start to use them. To make their usage a little clearer lets look at an example.</p>
<p>Assume we have the following functions at our disposal:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">final</span> <span class="cf">case</span> <span class="kw">class</span> <span class="fu">ItemId</span><span class="op">(</span>id<span class="op">:</span> <span class="ex">Long</span><span class="op">)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">final</span> <span class="cf">case</span> <span class="kw">class</span> <span class="fu">ItemDescReq</span><span class="op">(</span>itemId<span class="op">:</span> <span class="ex">Long</span><span class="op">,</span> userId<span class="op">:</span> <span class="ex">String</span><span class="op">)</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">final</span> <span class="cf">case</span> <span class="kw">class</span> <span class="fu">ItemDetail</span><span class="op">(</span>itemId<span class="op">:</span> <span class="ex">Long</span><span class="op">,</span> value<span class="op">:</span> <span class="ex">Double</span><span class="op">,</span> desc<span class="op">:</span> <span class="ex">String</span><span class="op">)</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">final</span> <span class="cf">case</span> <span class="kw">class</span> <span class="fu">User</span><span class="op">(</span>name<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> id<span class="op">:</span> <span class="ex">String</span><span class="op">)</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">final</span> <span class="cf">case</span> <span class="kw">class</span> <span class="fu">ValuableItemsResponse</span><span class="op">(</span>expensive<span class="op">:</span> <span class="ex">List</span><span class="op">[</span>ItemDetail<span class="op">],</span> veryExpensive<span class="op">:</span> <span class="ex">List</span><span class="op">[</span>ItemDetail<span class="op">])</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">final</span> <span class="cf">case</span> <span class="kw">class</span> <span class="fu">Price</span><span class="op">(</span>price<span class="op">:</span> <span class="ex">Double</span><span class="op">)</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> UserData <span class="op">=</span> <span class="ex">Map</span><span class="op">[</span><span class="ex">String</span><span class="op">,</span> <span class="ex">List</span><span class="op">[</span>ItemId<span class="op">]]</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> ItemData <span class="op">=</span> <span class="ex">Map</span><span class="op">[</span><span class="ex">Long</span><span class="op">,</span> ItemDetail<span class="op">]</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> Results  <span class="op">=</span> <span class="ex">List</span><span class="op">[</span>Either<span class="op">[</span><span class="ex">String</span><span class="op">,</span> ItemDetail<span class="op">]]</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> userData <span class="op">=</span> <span class="ex">Map</span><span class="op">[</span><span class="ex">String</span><span class="op">,</span> <span class="ex">List</span><span class="op">[</span>ItemId<span class="op">]](</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;1000&quot;</span> <span class="op">-&gt;</span> <span class="ex">List</span><span class="op">(</span><span class="fu">ItemId</span><span class="op">(</span><span class="dv">1001</span><span class="op">),</span> <span class="fu">ItemId</span><span class="op">(</span><span class="dv">1002</span><span class="op">),</span> <span class="fu">ItemId</span><span class="op">(</span><span class="dv">1003</span><span class="op">),</span> <span class="fu">ItemId</span><span class="op">(</span><span class="dv">1007</span><span class="op">),</span> <span class="fu">ItemId</span><span class="op">(</span><span class="dv">1004</span><span class="op">)),</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2000&quot;</span> <span class="op">-&gt;</span> <span class="ex">List</span><span class="op">(</span><span class="fu">ItemId</span><span class="op">(</span><span class="dv">2001</span><span class="op">),</span> <span class="fu">ItemId</span><span class="op">(</span><span class="dv">2002</span><span class="op">))</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> itemData <span class="op">=</span> <span class="ex">Map</span><span class="op">[</span><span class="ex">Long</span><span class="op">,</span> ItemDetail<span class="op">](</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    1001L <span class="op">-&gt;</span> <span class="fu">ItemDetail</span><span class="op">(</span><span class="dv">1001</span><span class="op">,</span> <span class="fl">2000.00</span><span class="op">,</span>  <span class="st">&quot;Couch&quot;</span><span class="op">),</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    1002L <span class="op">-&gt;</span> <span class="fu">ItemDetail</span><span class="op">(</span><span class="dv">1002</span><span class="op">,</span> <span class="fl">100.00</span><span class="op">,</span>   <span class="st">&quot;Apple TV&quot;</span><span class="op">),</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    1003L <span class="op">-&gt;</span> <span class="fu">ItemDetail</span><span class="op">(</span><span class="dv">1003</span><span class="op">,</span> <span class="fl">75000.00</span><span class="op">,</span> <span class="st">&quot;Luxury Car&quot;</span><span class="op">),</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    1004L <span class="op">-&gt;</span> <span class="fu">ItemDetail</span><span class="op">(</span><span class="dv">1004</span><span class="op">,</span> <span class="dv">3000</span><span class="op">,</span>     <span class="st">&quot;Laptop&quot;</span><span class="op">),</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    2001L <span class="op">-&gt;</span> <span class="fu">ItemDetail</span><span class="op">(</span><span class="dv">2001</span><span class="op">,</span> <span class="fl">1500.00</span><span class="op">,</span>  <span class="st">&quot;Coffee Machine&quot;</span><span class="op">),</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    2002L <span class="op">-&gt;</span> <span class="fu">ItemDetail</span><span class="op">(</span><span class="dv">2002</span><span class="op">,</span> <span class="fl">500.00</span><span class="op">,</span>   <span class="st">&quot;DLSR&quot;</span><span class="op">)</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> getSavedItems<span class="op">:</span> User <span class="op">=&gt;</span> UserData <span class="op">=&gt;</span> <span class="ex">List</span><span class="op">[</span>ItemId<span class="op">]</span> <span class="op">=</span> user <span class="op">=&gt;</span> data <span class="op">=&gt;</span> data<span class="op">.</span><span class="fu">getOrElse</span><span class="op">(</span>user<span class="op">.</span>id<span class="op">,</span> Nil<span class="op">)</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> idToDesc<span class="op">:</span> User <span class="op">=&gt;</span> ItemId <span class="op">=&gt;</span> ItemDescReq <span class="op">=</span> user <span class="op">=&gt;</span> itemId <span class="op">=&gt;</span> <span class="fu">ItemDescReq</span><span class="op">(</span>itemId<span class="op">.</span>id<span class="op">,</span> user<span class="op">.</span>id<span class="op">)</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> getDetails<span class="op">:</span> ItemDescReq <span class="op">=&gt;</span> ItemData <span class="op">=&gt;</span> Either<span class="op">[</span><span class="ex">String</span><span class="op">,</span> ItemDetail<span class="op">]</span> <span class="op">=</span> itemDescReq <span class="op">=&gt;</span> data <span class="op">=&gt;</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="fu">get</span><span class="op">(</span>itemDescReq<span class="op">.</span>itemId<span class="op">).</span><span class="fu">toRight</span><span class="op">(</span><span class="ss">s&quot;</span><span class="st">could not find item with id: </span><span class="ss">${</span>itemDescReq<span class="op">.</span>itemId<span class="ss">}&quot;</span><span class="op">)</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> isExpensive<span class="op">:</span> Range <span class="op">=&gt;</span> ItemDetail <span class="op">=&gt;</span> <span class="ex">Boolean</span> <span class="op">=</span> range <span class="op">=&gt;</span> item <span class="op">=&gt;</span> range<span class="op">.</span><span class="fu">contains</span><span class="op">(</span>item<span class="op">.</span>value<span class="op">)</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> valuableItemsResponse <span class="op">:</span> Tuple2<span class="op">[</span>Range<span class="op">,</span> Range<span class="op">]</span> <span class="op">=&gt;</span> <span class="ex">List</span><span class="op">[</span>ItemDetail<span class="op">]</span> <span class="op">=&gt;</span> ValuableItemsResponse <span class="op">=</span> prices <span class="op">=&gt;</span> items <span class="op">=&gt;</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ValuableItemsResponse</span><span class="op">(</span>items<span class="op">.</span><span class="fu">filter</span><span class="op">(</span><span class="fu">isExpensive</span><span class="op">(</span>prices<span class="op">.</span>_1<span class="op">)),</span> items<span class="op">.</span><span class="fu">filter</span><span class="op">(</span><span class="fu">isExpensive</span><span class="op">(</span>prices<span class="op">.</span>_2<span class="op">)))</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> valuableItemsResponseString<span class="op">:</span> ValuableItemsResponse <span class="op">=&gt;</span> <span class="ex">String</span> <span class="op">=</span> items <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    <span class="ss">s&quot;</span><span class="st">expensive:</span><span class="ss">${</span><span class="fu">itemDetailString</span><span class="op">(</span>items<span class="op">.</span>expensive<span class="op">)</span><span class="ss">}</span><span class="st">,veryExpensive:</span><span class="ss">${</span><span class="fu">itemDetailString</span><span class="op">(</span>items<span class="op">.</span>veryExpensive<span class="op">)</span><span class="ss">}&quot;</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> itemDetailString<span class="op">:</span> <span class="ex">List</span><span class="op">[</span>ItemDetail<span class="op">]</span> <span class="op">=&gt;</span> <span class="ex">String</span> <span class="op">=</span> _<span class="op">.</span><span class="fu">map</span><span class="op">(</span>id <span class="op">=&gt;</span> <span class="ss">s&quot;${</span>id<span class="op">.</span>desc<span class="ss">}</span><span class="st">=</span><span class="ch">$$</span><span class="ss">${</span>id<span class="op">.</span>value<span class="ss">}&quot;</span><span class="op">).</span><span class="fu">mkString</span><span class="op">(</span><span class="st">&quot;,&quot;</span><span class="op">)</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> errorString<span class="op">:</span> <span class="ex">List</span><span class="op">[</span>Either<span class="op">[</span><span class="ex">String</span><span class="op">,</span> ItemDetail<span class="op">]]</span> <span class="op">=&gt;</span> <span class="ex">String</span> <span class="op">=</span> itemsE <span class="op">=&gt;</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    itemsE<span class="op">.</span>collect <span class="op">{</span> <span class="cf">case</span> <span class="fu">Left</span><span class="op">(</span>error<span class="op">)</span> <span class="op">=&gt;</span> error <span class="op">}</span> <span class="fu">mkString</span><span class="op">(</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span><span class="op">)</span></span></code></pre></div>
<p>We now want to use the above functions to do the following:</p>
<ol type="1">
<li>Get the saved items for a User.</li>
<li>Convert each item to a item request.</li>
<li>Look up the details of each item requested. (this may fail)</li>
<li>Filter the successful requests against two price ranges, one for <em>expensive</em> and the other for very <em>expensive</em>.</li>
<li>The filtered items should then be put into a ValuableItemsResponse object.</li>
<li>At the end we need to print out a description of the valuable items found and any errors that were generated.</li>
</ol>
<p>We can then glue these functions together to give us the output we desire:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// User =&gt; (UserData =&gt; List[ItemId], (ItemId =&gt; ItemDescReq))</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> f1 <span class="op">=</span> ArrowFuncs<span class="op">.</span><span class="fu">combine</span><span class="op">(</span>getSavedItems<span class="op">,</span> idToDesc<span class="op">)</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// User =&gt; List[ItemDescReq]</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> f2 <span class="op">=</span> f1 <span class="op">&gt;&gt;&gt;</span> <span class="op">{</span> <span class="cf">case</span> <span class="op">(</span>fi<span class="op">,</span> fd<span class="op">)</span> <span class="op">=&gt;</span>  <span class="fu">fi</span><span class="op">(</span>userData<span class="op">)</span> map fd <span class="op">}</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">//User =&gt; (Results, Results)</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> f3 <span class="op">=</span> f2 <span class="op">&gt;&gt;&gt;</span> <span class="op">(</span>_ map getDetails<span class="op">)</span> <span class="op">&gt;&gt;&gt;</span> <span class="op">(</span>_ <span class="fu">map</span> <span class="op">(</span><span class="fu">_</span><span class="op">(</span>itemData<span class="op">)))</span> <span class="op">&gt;&gt;&gt;</span> <span class="op">(</span>_<span class="op">.</span><span class="fu">partition</span><span class="op">(</span>_<span class="op">.</span>isLeft<span class="op">))</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">//(Results, Results) =&gt; (Results, List[ItemDetail])</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> f4 <span class="op">=</span> fa<span class="op">.</span>second<span class="op">[</span>Results<span class="op">,</span> <span class="ex">List</span><span class="op">[</span>ItemDetail<span class="op">],</span> Results<span class="op">](</span>_ collect <span class="op">{</span> <span class="cf">case</span> <span class="fu">Right</span><span class="op">(</span>value<span class="op">)</span> <span class="op">=&gt;</span> value <span class="op">})</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">//User =&gt; (Results, List[ItemDetail])</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> f5 <span class="op">=</span> f3 <span class="op">&gt;&gt;&gt;</span> f4</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">//(Results, List[ItemDetail]) =&gt; (Results, Tuple2[Range, Range] =&gt; ValuableItemsResponse)</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> f6 <span class="op">=</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    fa<span class="op">.</span>second<span class="op">[</span><span class="ex">List</span><span class="op">[</span>ItemDetail<span class="op">],</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>              Tuple2<span class="op">[</span>Range<span class="op">,</span> Range<span class="op">]</span> <span class="op">=&gt;</span> ValuableItemsResponse<span class="op">,</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>              Results<span class="op">](</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>      items <span class="op">=&gt;</span> prices <span class="op">=&gt;</span> <span class="fu">valuableItemsResponse</span><span class="op">(</span>prices<span class="op">)(</span>items<span class="op">)</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>   <span class="co">//User =&gt; (Results, Tuple2[Range, Range] =&gt; ValuableItemsResponse)</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>   <span class="kw">val</span> f7 <span class="op">=</span> f5 <span class="op">&gt;&gt;&gt;</span>  f6</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>   <span class="co">//(Results, Tuple2[Range, Range] =&gt; ValuableItemsResponse) =&gt; (Results, ValuableItemsResponse)</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>   <span class="kw">val</span> f8 <span class="op">=</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    fa<span class="op">.</span>second<span class="op">[</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>      Tuple2<span class="op">[</span>Range<span class="op">,</span> Range<span class="op">]</span> <span class="op">=&gt;</span> ValuableItemsResponse<span class="op">,</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>      ValuableItemsResponse<span class="op">,</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>      Results<span class="op">](</span><span class="fu">_</span><span class="op">(</span><span class="fu">Range</span><span class="op">(</span><span class="dv">500</span><span class="op">,</span> <span class="dv">3000</span><span class="op">),</span> <span class="fu">Range</span><span class="op">(</span><span class="dv">10000</span><span class="op">,</span> <span class="dv">100000</span><span class="op">)))</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">//User =&gt; (Results, ValuableItemsResponse)</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> f9 <span class="op">=</span> f7 <span class="op">&gt;&gt;&gt;</span> f8</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">//(Results, ValuableItemsResponse) =&gt; (String, String)</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> f10 <span class="op">=</span> fa<span class="op">.</span>split<span class="op">[</span>Results<span class="op">,</span> <span class="ex">String</span><span class="op">,</span> ValuableItemsResponse<span class="op">,</span> <span class="ex">String</span><span class="op">](</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    errorString<span class="op">,</span> valuableItemsResponseString</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">//User =&gt; (String, String)</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> f11 <span class="op">=</span> f9 <span class="op">&gt;&gt;&gt;</span> f10</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="op">(</span>errors<span class="op">,</span> values<span class="op">)</span> <span class="op">=</span> <span class="fu">f11</span><span class="op">(</span><span class="fu">User</span><span class="op">(</span><span class="st">&quot;Guybrush threepwood&quot;</span><span class="op">,</span> <span class="st">&quot;1000&quot;</span><span class="op">))</span></span></code></pre></div>
<p>which outputs:</p>
<pre class="terminal scrollx"><code>expensive:Couch=$2000.0,veryExpensive:Luxury Car=$75000.0, errors: could not find item with id: 1007</code></pre>
<p>or more succinctly:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode scala scrollx"><code class="sourceCode scala"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> pipeline <span class="op">=</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    ArrowFuncs<span class="op">.</span><span class="fu">combine</span><span class="op">(</span>getSavedItems<span class="op">,</span> idToDesc<span class="op">)</span> <span class="op">&gt;&gt;&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="cf">case</span> <span class="op">(</span>fi<span class="op">,</span> fd<span class="op">)</span> <span class="op">=&gt;</span>  <span class="fu">fi</span><span class="op">(</span>userData<span class="op">)</span> map fd <span class="op">}</span> <span class="op">&gt;&gt;&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>_ map getDetails<span class="op">)</span> <span class="op">&gt;&gt;&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>_ <span class="fu">map</span> <span class="op">(</span><span class="fu">_</span><span class="op">(</span>itemData<span class="op">)))</span> <span class="op">&gt;&gt;&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>_<span class="op">.</span><span class="fu">partition</span><span class="op">(</span>_<span class="op">.</span>isLeft<span class="op">))</span> <span class="op">&gt;&gt;&gt;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    fa<span class="op">.</span>second<span class="op">[</span>Results<span class="op">,</span> <span class="ex">List</span><span class="op">[</span>ItemDetail<span class="op">],</span> Results<span class="op">](</span>_ collect <span class="op">{</span> <span class="cf">case</span> <span class="fu">Right</span><span class="op">(</span>value<span class="op">)</span> <span class="op">=&gt;</span> value <span class="op">})</span> <span class="op">&gt;&gt;&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    fa<span class="op">.</span>second<span class="op">[</span><span class="ex">List</span><span class="op">[</span>ItemDetail<span class="op">],</span> Tuple2<span class="op">[</span>Range<span class="op">,</span> Range<span class="op">]</span> <span class="op">=&gt;</span> ValuableItemsResponse<span class="op">,</span> Results<span class="op">](</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>      items <span class="op">=&gt;</span> prices <span class="op">=&gt;</span> <span class="fu">valuableItemsResponse</span><span class="op">(</span>prices<span class="op">)(</span>items<span class="op">)</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span> <span class="op">&gt;&gt;&gt;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    fa<span class="op">.</span>second<span class="op">[</span>Tuple2<span class="op">[</span>Range<span class="op">,</span> Range<span class="op">]</span> <span class="op">=&gt;</span> ValuableItemsResponse<span class="op">,</span> ValuableItemsResponse<span class="op">,</span> Results<span class="op">](</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">_</span><span class="op">(</span><span class="fu">Range</span><span class="op">(</span><span class="dv">500</span><span class="op">,</span> <span class="dv">3000</span><span class="op">),</span> <span class="fu">Range</span><span class="op">(</span><span class="dv">10000</span><span class="op">,</span> <span class="dv">100000</span><span class="op">))</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span> <span class="op">&gt;&gt;&gt;</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    fa<span class="op">.</span>split<span class="op">[</span>Results<span class="op">,</span> <span class="ex">String</span><span class="op">,</span> ValuableItemsResponse<span class="op">,</span> <span class="ex">String</span><span class="op">](</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>      errorString<span class="op">,</span> valuableItemsResponseString</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> <span class="op">(</span>errors<span class="op">,</span> values<span class="op">)</span> <span class="op">=</span> <span class="fu">pipeline</span><span class="op">(</span><span class="fu">User</span><span class="op">(</span><span class="st">&quot;Guybrush threepwood&quot;</span><span class="op">,</span> <span class="st">&quot;1000&quot;</span><span class="op">))</span></span></code></pre></div>
<p>Hopefully this has given you a gentle introduction into the world of Arrows.</p>
          </article>
        </div>
        
          <div id="disqus_thread"></div>
          <script>
              /**
              *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
              *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */

              var disqus_config = function () {
              this.page.url = 'https://ssanj.github.io' + '/posts/2017-07-02-working-with-arrows-in-scala.html';
              this.page.identifier = '/posts/2017-07-02-working-with-arrows-in-scala.html';
              };

              (function() { // DON'T EDIT BELOW THIS LINE
              var d = document, s = d.createElement('script');
              s.src = 'https://babyloncandle.disqus.com/embed.js';
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        
    </div>


      
    </body>
    <script src="../js/jquery-1.11.1.min.js"></script>
    <script src="../js/typeahead.bundle.min.js"></script>
    <script src="../js/handlebars-v1.3.0.js"></script>
    <script src="../js/babyloncandle.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55156872-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-55156872-1');
    </script>
</html>
